// https://esm.sh/v135/nanostores@0.9.5/es2022/nanostores.mjs
/* esm.sh - esbuild bundle(nanostores@0.9.5) es2022 production */
var m=0,N=[];function y(){return m+=1,()=>{if(m-=1,m===0){let e=N;N=[];for(let t of e)t()}}}function R(e){let t=y();return e().finally(t)}function _(){return m===0?Promise.resolve():new Promise(e=>{N.push(e)})}function S(){m=0}var d=Symbol(),x=Symbol(),L=0,D=(e,t,r,n)=>{let i=++L,o={...e};o.set=(...u)=>{e[d]=t,e[x]=i,e.set(...u),delete e[d],delete e[x]},e.setKey&&(o.setKey=(...u)=>{e[d]=t,e[x]=i,e.setKey(...u),delete e[d],delete e[x]});let l,f;e.action&&([l,f]=e.action(i,t,n));let s=r(o,...n);if(s instanceof Promise){let u=y();return s.catch(v=>{throw l&&l(v),v}).finally(()=>{u(),f&&f()})}return f&&f(),s},K=(e,t,r)=>(...n)=>D(e,t,r,n);var E=Symbol("clean"),w=(...e)=>{throw new Error("cleanStores() can be used only during development or tests")};var a=[],p=(e,t)=>{let r=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},l:t||0,lc:0,listen(i,o){return n.lc=r.push(i,o||n.l)/2,()=>{let l=r.indexOf(i);~l&&(r.splice(l,2),--n.lc||n.off())}},notify(i){let o=!a.length;for(let l=0;l<r.length;l+=2)a.push(r[l],r[l+1],n.value,i);if(o){for(let l=0;l<a.length;l+=4){let f;for(let s=l+1;!f&&(s+=4)<a.length;)a[s]<a[l+1]&&(f=a.push(a[l],a[l+1],a[l+2],a[l+3]));f||a[l](a[l+2],a[l+3])}a.length=0}},off(){},set(i){n.value!==i&&(n.value=i,n.notify())},subscribe(i,o){let l=n.listen(i,o);return i(n.value),l},value:e};return n};var Y=0,C=1,F=2,Q=3,V=5,T=6,B=7,h=10,c=(e,t,r,n)=>(e.events=e.events||{},e.events[r+h]||(e.events[r+h]=n(i=>{e.events[r].reduceRight((o,l)=>(l(o),o),{shared:{},...i})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let i=e.events[r],o=i.indexOf(t);i.splice(o,1),i.length||(delete e.events[r],e.events[r+h](),delete e.events[r+h])}),X=(e,t)=>c(e,t,Y,r=>{let n=e.listen;return e.listen=i=>(!e.lc&&!e.starting&&(e.starting=!0,r(),delete e.starting),n(i)),()=>{e.listen=n}}),q=(e,t)=>c(e,t,C,r=>{let n=e.off;return e.off=()=>{r(),n()},()=>{e.off=n}}),z=(e,t)=>c(e,t,F,r=>{let n=e.set,i=e.setKey;return e.setKey&&(e.setKey=(o,l)=>{let f;if(r({abort:()=>{f=!0},changed:o,newValue:{...e.value,[o]:l}}),!f)return i(o,l)}),e.set=o=>{let l;if(r({abort:()=>{l=!0},newValue:o}),!l)return n(o)},()=>{e.set=n,e.setKey=i}}),G=(e,t)=>c(e,t,Q,r=>{let n=e.notify;return e.notify=i=>{let o;if(r({abort:()=>{o=!0},changed:i}),!o)return n(i)},()=>{e.notify=n}}),M=1e3,O=(e,t)=>c(e,n=>{let i=t(n);i&&e.events[T].push(i)},V,n=>{let i=e.listen;e.listen=(...l)=>(!e.lc&&!e.active&&(e.active=!0,n()),i(...l));let o=e.off;return e.events[T]=[],e.off=()=>{o(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let l of e.events[T])l();e.events[T]=[]}},M)},()=>{e.listen=i,e.off=o}}),H=(e,t)=>c(e,t,B,r=>{let n={},i={},o=e.action;return e.action=(l,f,s)=>(r({actionName:f,args:s,id:l,onEnd:u=>{(i[l]||(i[l]=[])).push(u)},onError:u=>{(n[l]||(n[l]=[])).push(u)}}),[u=>{if(n[l])for(let v of n[l])v({error:u})},()=>{if(i[l]){for(let u of i[l])u();delete n[l],delete i[l]}}]),()=>{e.action=o}});var J=(e,t)=>{Array.isArray(e)||(e=[e]);let r,n=()=>{let o=e.map(l=>l.get());(r===void 0||o.some((l,f)=>l!==r[f]))&&(r=o,i.set(t(...o)))},i=p(void 0,Math.max(...e.map(o=>o.l))+1);return O(i,()=>{let o=e.map(l=>l.listen(n,i.l));return n(),()=>{for(let l of o)l()}}),i};function A(e,t){let r=U(t),n=e;for(let i of r){if(n===void 0)break;n=n[i]}return n}function g(e,t,r){return k(e??{},U(t),r)}function k(e,t,r){let n=t[0];W(e,n,t[1]);let i=Array.isArray(e)?[...e]:{...e};if(t.length===1)return r===void 0?Array.isArray(e)?i.splice(n,1):delete i[n]:i[n]=r,i;let o=k(e[n],t.slice(1),r);return e[n]=o,e}var P=/(.*)\[(\d+)\]/;function U(e){return e.split(".").flatMap(t=>I(t))}function I(e){if(P.test(e)){let[,t,r]=e.match(P);return[...I(t),r]}return[e]}function W(e,t,r){if(t in e)return;let n=parseInt(r??"");Number.isNaN(n)?e[t]={}:e[t]=Array(n+1).fill(void 0)}function Z(e={}){let t=p(e);return t.setKey=(r,n)=>{A(t.value,r)!==n&&(t.value={...g(t.value,r,n)},t.notify(r))},t}var b=e=>{e.listen(()=>{})};function j(e,t,r){let n=new Set([...t,void 0]);return e.listen((i,o)=>{n.has(o)&&r(i,o)})}var $=(e={})=>{let t=p(e);return t.setKey=function(r,n){typeof n>"u"?r in t.value&&(t.value={...t.value},delete t.value[r],t.notify(r)):t.value[r]!==n&&(t.value={...t.value,[r]:n},t.notify(r))},t};export{M as STORE_UNMOUNT_DELAY,K as action,x as actionId,_ as allTasks,p as atom,E as clean,w as cleanStores,S as cleanTasks,J as computed,Z as deepMap,A as getPath,b as keepMount,d as lastAction,j as listenKeys,$ as map,H as onAction,O as onMount,G as onNotify,z as onSet,X as onStart,q as onStop,g as setPath,y as startTask,R as task};
